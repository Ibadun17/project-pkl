<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Login | Diskominfo Kota Madiun</title>

  <style>
    :root{
      --primary:#0a1f8f;
      --primary-dark:#081870;
      --text:#333;
      --muted:#7a7a7a;
      --border:#bdbdbd;
      --card:#f6f3f3;
      --shadow:0 4px 10px rgba(0,0,0,.18);
    }
    *{box-sizing:border-box}
    body{margin:0;font-family: Arial, Helvetica, sans-serif;background:#fff;color:var(--text);}

    .topbar{height:72px;background:var(--primary);display:flex;align-items:center;padding:0 40px;}
    .brand{display:flex;align-items:center;gap:14px;color:#fff;}
    .brand img{width:48px;height:auto;}
    .brand-text{font-size:14px;font-weight:700;line-height:1.2;text-transform:uppercase;}

    main{min-height:calc(100vh - 72px);display:flex;flex-direction:column;align-items:center;padding-top:70px;}

    .card{
      width:560px;max-width:92%;
      background:var(--card);
      border-radius:4px;
      box-shadow:var(--shadow);
      padding:36px 60px;
      border:1px solid #e0e0e0;
    }
    .card h1{text-align:center;color:var(--primary);margin:0 0 28px;font-size:30px;letter-spacing:.5px;}

    label{display:block;font-size:18px;font-weight:700;color:#6b6b6b;margin-bottom:8px;}
    .field{margin-bottom:18px;}
    input{
      width:100%;height:38px;border:1px solid var(--border);
      padding:0 12px;font-size:14px;border-radius:2px;
    }
    input::placeholder{color:#b5b5b5;}

    .password-wrapper{position:relative;}
    .toggle-password{
      position:absolute;right:10px;top:50%;transform:translateY(-50%);
      border:none;background:none;cursor:pointer;font-size:16px;color:#888;
    }

    .btn-login{
      display:block;margin:24px auto 0;padding:6px 28px;
      background:var(--primary);color:#fff;border:none;border-radius:4px;
      font-weight:700;cursor:pointer;
    }
    .btn-login:hover{background:var(--primary-dark);}

    /* message box */
    .msg{
      display:none;
      margin:0 0 14px;
      padding:10px 12px;
      border-radius:4px;
      font-size:14px;
      background:#fff;
      border:1px solid #ddd;
      color:#444;
    }
    .msg.ok{border-color:#37b36b;color:#1c7f45;background:#f2fff7;}
    .msg.err{border-color:#e34b4b;color:#a01818;background:#fff2f2;}

    .footer{text-align:center;margin-top:34px;font-size:14px;color:#9a9a9a;}
    .footer a{color:var(--primary);text-decoration:none;font-weight:600;}
    .google-btn{
      margin-top:16px;display:inline-flex;align-items:center;gap:10px;
      padding:8px 18px;background:#f3f3f3;border:1px solid #e2e2e2;
      border-radius:4px;box-shadow:0 2px 6px rgba(0,0,0,.12);
      cursor:pointer;color:#8a8a8a;font-weight:600;
    }
    .google-btn img{width:18px;}

    @media(max-width:500px){
      .card{padding:28px 20px}
      label{font-size:16px}
    }
  </style>
</head>

<body>
  <header class="topbar">
    <div class="brand">
      <img src="../assets/img/logo.png" alt="Logo Diskominfo">
      <div class="brand-text">
        DINAS KOMUNIKASI DAN INFORMATIKA<br>
        KOTA MADIUN
      </div>
    </div>
  </header>

  <main>
    <section class="card">
      <h1>MASUK</h1>

      <div id="msg" class="msg"></div>

      <form id="loginForm" novalidate>
        <div class="field">
          <label>Email/Username</label>
          <input id="email" type="text" placeholder="Masukkan Email/Username" autocomplete="username">
        </div>

        <div class="field">
          <label>Password</label>
          <div class="password-wrapper">
            <input id="password" type="password" placeholder="Masukkan Password" autocomplete="current-password">
            <button type="button" class="toggle-password" id="togglePassBtn">üëÅ</button>
          </div>
        </div>

        <button class="btn-login" id="btnLogin" type="submit">Masuk</button>
      </form>
    </section>

    <div class="footer">
      <p><b>Belum Punya Akun?</b> <a href="register.html">Daftar</a></p>
      <button class="google-btn" type="button" onclick="alert('Google login belum diaktifkan')">
        <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="">
        Login dengan Google
      </button>
    </div>
  </main>

  <script src="../js/api.js"></script>
  <script>
    // Toggle password (lebih aman: tanpa inline onclick)
    document.getElementById('togglePassBtn').addEventListener('click', () => {
      const pass = document.getElementById('password');
      pass.type = pass.type === 'password' ? 'text' : 'password';
    });

    function showMsg(type, text){
      const el = document.getElementById('msg');
      el.className = 'msg ' + (type === 'ok' ? 'ok' : 'err');
      el.textContent = text;
      el.style.display = 'block';
    }

    function normalizeErr(err){
      if (!err) return 'Terjadi kesalahan.';
      if (typeof err === 'string') return err;
      if (err.message) return err.message;
      return 'Terjadi kesalahan.';
    }

    document.getElementById('loginForm').addEventListener('submit', async (e) => {
      e.preventDefault();

      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value;

      if(!email || !password){
        showMsg('err', 'Email dan password wajib diisi.');
        return;
      }

      const btn = document.getElementById('btnLogin');
      btn.disabled = true;
      btn.textContent = 'Memproses...';

      try{
        const res = await apiFetch('/auth/login.php', {
          method: 'POST',
          body: { email, password }
        });

        showMsg('ok', (res && res.message) ? res.message : 'Login sukses');
        setTimeout(() => window.location.href = 'home.html', 500);
      }catch(err){
        showMsg('err', normalizeErr(err));
      }finally{
        btn.disabled = false;
        btn.textContent = 'Masuk';
      }
    });
  </script>
</body>
</html>
